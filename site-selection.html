<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pay Calculator â€” Select Site</title>
<style>
  :root{
    --green:#1B5E20; --green-600:#124318; --orange:#FF7A00;
    --paper:#FFFFFF; --ink:#1f2937; --muted:#6b7280;
    --border:#e5e7eb; --shadow:0 8px 28px rgba(0,0,0,.08), 0 2px 8px rgba(0,0,0,.05);
    --tint: color-mix(in srgb, var(--green) 7%, #fff);
    --radius:14px;
  }
  *{box-sizing:border-box}
  html,body{margin:0; width:100%; min-height:100%; background:#f8fafc; color:var(--ink); font-family:ui-sans-serif,system-ui;}
  body{display:flex; flex-direction:column}
  .container{max-width:1100px; width:100%; margin:0 auto; padding:0 16px}

  /* Header */
  .app-header{
    position:sticky; top:0; z-index:10;
    background:linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.85));
    border-bottom:1px solid var(--border)
  }
  .header-row{
    display:flex; align-items:center; justify-content:space-between;
    height:clamp(56px, 8vw, 100px);
  }

  /* Logo link + sizing */
  .logo-link{
    display:inline-flex; align-items:center; text-decoration:none;
    transition:filter .2s ease, opacity .2s ease;
    height:100%;
  }
  .logo-link:hover{ filter:brightness(1.05); opacity:.9; }
  .logo-img{
    display:block; height:calc(100% - 10px); width:auto; object-fit:contain;
  }

  /* Welcome */
  .welcome{font-weight:700;color:var(--green-600); font-size:14px; margin-right:10px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:40ch;}

  /* Back pill button */
  .back-btn{
    display:inline-flex; align-items:center; gap:10px;
    padding:10px 18px; border-radius:999px;
    background:#fff; color:var(--green); font-weight:800;
    border:1px solid var(--border); text-decoration:none;
    box-shadow:0 1px 0 rgba(0,0,0,.02);
    transition:transform .03s ease, background .15s ease, box-shadow .15s ease;
  }
  .back-btn svg{ width:18px; height:18px; display:block; stroke:var(--green); stroke-width:2.2; fill:none; flex-shrink:0 }
  .back-btn:hover{background:#f9fafb; box-shadow:0 2px 10px rgba(0,0,0,.04)}
  .back-btn:active{transform:translateY(1px)}
  .back-btn:focus-visible{outline:3px solid color-mix(in srgb, var(--green) 18%, transparent); outline-offset:2px}

  /* Card shell */
  main{flex:1; display:grid; place-items:start; padding:24px 0}
  .card{width:100%; background:var(--paper); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow)}
  .card-header{padding:20px; border-bottom:1px solid var(--border); background:linear-gradient(180deg, var(--tint), #fff 80%); border-left:4px solid var(--orange); border-top-left-radius:var(--radius)}
  .card-header h1{margin:0; font-size:22px; color:var(--green-600)}
  .card-body{padding:20px}

  /* Grid selector */
  .grid{display:grid; gap:14px; grid-template-columns:repeat(2,minmax(0,1fr));}
  @media(min-width:840px){.grid{grid-template-columns:repeat(3,minmax(0,1fr));}}
  @media(min-width:1100px){.grid{grid-template-columns:repeat(4,minmax(0,1fr));}}

  .site-card{
    position:relative; display:block; width:100%;
    aspect-ratio:1/1;
    border:1px solid var(--border); border-radius:14px;
    overflow:hidden; cursor:pointer; background:#eef3ee;
    transition:box-shadow .18s ease, border-color .18s ease, transform .02s ease-in;
    outline:none;
  }
  .site-card::before{content:""; float:left; padding-top:100%}
  .site-card::after{content:""; display:block; clear:both}

  .site-thumb{
    position:absolute; inset:0; width:100%; height:100%;
    object-fit:cover; object-position:center;
    filter:saturate(1.05);
    transition:transform .25s ease, filter .2s ease, opacity .2s ease;
  }
  .site-card:hover .site-thumb{transform:scale(1.02)}

  .overlay{
    position:absolute; inset:0;
    display:flex; align-items:flex-end; justify-content:center;
    padding:12px; pointer-events:none; background:none;
  }
  .site-card[aria-checked="true"] .overlay{
    background:linear-gradient(to top, rgba(0,0,0,.35), rgba(0,0,0,0) 60%);
  }

  .label{
    background:rgba(255,255,255,.78);
    color:#0f172a; font-weight:800; text-align:center;
    border-radius:12px; padding:6px 12px;
    inline-size:max-content;
    max-inline-size: min(95%, 22ch);
    margin-inline:auto;
    line-height:1.2; word-break:break-word;
    box-shadow:0 2px 8px rgba(0,0,0,.15);
  }

  .check{
    position:absolute; top:8px; left:8px; width:28px; height:28px;
    border-radius:999px; background:#fff; border:1px solid rgba(0,0,0,.06);
    display:grid; place-items:center; box-shadow:0 2px 6px rgba(0,0,0,.15);
    opacity:0; transform:scale(.9); transition:opacity .18s ease, transform .18s ease;
  }
  .check svg{width:18px; height:18px; display:block; stroke:var(--green); stroke-width:3; fill:none}

  .site-card[aria-checked="true"]{
    border-color: color-mix(in srgb, var(--green) 40%, var(--border));
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--green) 18%, transparent);
    background:#fafdfb;
  }
  .site-card[aria-checked="true"] .check{opacity:1; transform:scale(1)}

  .has-selection .site-card[aria-checked="false"] .site-thumb{
    filter:grayscale(1) contrast(0.95) brightness(0.95);
    opacity:.85;
  }

  .sr{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

  .row{display:flex; flex-wrap:wrap; gap:12px; justify-content:center; margin-top:24px}
  .btn{flex:1 1 auto; max-width:200px; display:inline-flex; align-items:center; justify-content:center;
    gap:8px; border-radius:999px; padding:10px 16px; font-weight:800;
    border:1px solid var(--border); background:#fff; color:var(--green);
    cursor:pointer; text-align:center;
  }
  .btn.primary{background:var(--green); border-color:var(--green); color:#fff}
  .btn:disabled{opacity:.5; cursor:not-allowed}

  footer{padding:12px 0; text-align:center; font-size:13px; color:#bbb}
</style>
</head>
<body>

<header class="app-header">
  <div class="container header-row">
    <!-- Clickable local logo with hover effect -->
    <a href="index.html" class="logo-link" aria-label="Home">
      <img src="images/HI-Emblem-green.png" alt="Holiday Inn Club Vacations Emblem" class="logo-img">
    </a>

    <div style="display:flex; align-items:center; gap:10px">
      <div id="welcome" class="welcome" aria-live="polite"></div>
      <a href="index.html" class="back-btn" aria-label="Go Back to previous page">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M7 12h13M7 12l5-5M7 12l5 5"/></svg>
        <span>Go Back</span>
      </a>
    </div>
  </div>
</header>

<main>
  <div class="container">
    <section class="card" aria-labelledby="title">
      <div class="card-header">
        <h1 id="title">Select Your Site</h1>
      </div>
      <div class="card-body">
        <div role="radiogroup" aria-label="Site selection" class="grid" id="siteGrid"></div>

        <div class="row">
          <button id="clearBtn" class="btn" type="button">Clear Selection</button>
          <button id="continueBtn" class="btn primary" type="button" disabled>Continue</button>
        </div>
      </div>
    </section>
  </div>
</main>

<footer>Created by Aaron Feight 2025</footer>

<script>
/* =========================
   Persist API (shared)
   ========================= */
const Persist = (() => {
  const LOCAL_PREFIX = 'hi-calc:v1';
  const key = (emp,page)=> `${LOCAL_PREFIX}:${emp}:${page}`;
  async function load(emp,page){ if(!emp) return null; const raw = localStorage.getItem(key(emp,page)); return raw ? JSON.parse(raw) : null; }
  async function save(emp,page,data){ if(!emp) return; localStorage.setItem(key(emp,page), JSON.stringify(data)); return true; }
  function getLastEmployee(){ return localStorage.getItem(`${LOCAL_PREFIX}:last-employee`) || ''; }
  return {load, save, getLastEmployee};
})();

(() => {
  /* ===== Employee context & guard ===== */
  const welcomeEl = document.getElementById('welcome');
  const lastEmp = Persist.getLastEmployee();
  if(!lastEmp){
    // No active session -> send back to splash / login
    window.location.href = 'index.html';
    return;
  }

  // Pull first-name greeting from calculator-selection page state if present
  (async () => {
    const sel = await Persist.load(lastEmp, 'calculator-selection');
    const first = sel && sel.name ? String(sel.name) : '';
    welcomeEl.textContent = first ? `Welcome, ${first}` : 'Welcome';
  })();

  /* ===== Routing rules per site ===== */
  function pageForSite(id){
    // Keep your existing mapping
    return (id === 'south-beach') ? 'HICV-MB-Pay-Calc.html' : 'HICV-General-Pay-Calc.html';
  }

  /* ===== Sites data ===== */
  const SITES = [
    { id:'cape-canaveral',name:'Cape Canaveral',img:'https://images.contentstack.io/v3/assets/bltba617d00249585dc/bltd5e047ac82ec503c/61a794c237c855238d66ec0c/cape-canaveral-resort-property-building-sunset-1440x1080.jpg'},
    { id:'david-walleys',name:'David Walleys',img:'https://images.contentstack.io/v3/assets/bltba617d00249585dc/blt08b954f4f80c7ee7/5e290fd1bad1555533de72e0/DWR_Amenities_HotSprings_Pool_001.jpg'},
    { id:'desert-club',name:'Desert Club',img:'https://images.contentstack.io/v3/assets/bltba617d00249585dc/bltba57961e1c76781e/5e54342d03d2600dc053dc8f/DCR_amenities_WateringHole_020.jpg'},
    { id:'holiday-hills',name:'Holiday Hills',img:'https://images.contentstack.io/v3/assets/bltba617d00249585dc/bltc9cc49c72b923b72/5e2f21fc8f7e217daef663fa/HHR_property_Resort_001.jpg'},
    { id:'new-orleans',name:'New Orleans',img:'https://images.contentstack.io/v3/assets/bltba617d00249585dc/blt0bde089d15479ba0/5fdba695b47cdf7fc7d68d16/20201202_NOR_0184AB_(1)-card.jpg'},
    { id:'orange-lake',name:'Orange Lake Resort',img:'https://images.contentstack.io/v3/assets/bltba617d00249585dc/bltf04192786a7478ff/66c8bea691a856f9a470348a/orange-lake-resort-river-island-exchange-exterior-1440x1080.jpg'},
    { id:'scottsdale',name:'Scottsdale',img:'https://images.contentstack.io/v3/assets/bltba617d00249585dc/blte2ff00e280785c31/5e2f6a8f507d2f74fb78c1cf/SDR_Amenities_Pool_025.JPG'},
    { id:'seaside',name:'Seaside',img:'https://images.contentstack.io/v3/assets/bltba617d00249585dc/bltc0d2242526c7465e/605cb0545d7a7e0ef01ab30f/SSR_Building-4320x2048.jpeg'},
    { id:'smoky-mountain',name:'Smoky Mountain',img:'https://images.contentstack.io/v3/assets/bltba617d00249585dc/blt25ba35c9bfe5e356/5e6115b88abca6651fc8c4b0/SMR_amenities_pool_010.jpg'},
    { id:'south-beach',name:'South Beach Resort',img:'https://images.contentstack.io/v3/assets/bltba617d00249585dc/blt3feb49ba4da8f26d/5e4590eb5e52d50d64528109/SBR_property_CheckIn_003.jpg'},
    { id:'williamsburg',name:'Williamsburg',img:'https://images.contentstack.io/v3/assets/bltba617d00249585dc/blt0dd0b98197e30327/5daf1a6adf78486c826dc4b9/holiday-inn-club-vacations-williamsburg-5745140523-16x5.jpeg'}
  ];

  /* ===== DOM ===== */
  const siteGrid=document.getElementById('siteGrid');
  const continueBtn=document.getElementById('continueBtn');
  const clearBtn=document.getElementById('clearBtn');

  /* ===== State ===== */
  const PAGE_ID = 'site-selection';
  let selectedId=null;

  /* ===== Render ===== */
  function renderGrid(){
    siteGrid.innerHTML=SITES.map((s,idx)=>`
      <button class="site-card" role="radio" aria-checked="false" tabindex="${idx===0?'0':'-1'}" data-id="${s.id}" data-name="${s.name}">
        <img class="site-thumb" src="${s.img}" alt="${s.name}" loading="lazy">
        <div class="check" aria-hidden="true">
          <svg viewBox="0 0 24 24"><path d="M5 12l4 4L19 6"/></svg>
        </div>
        <div class="overlay"><div class="label">${s.name}</div></div>
        <span class="sr">Site: ${s.name}</span>
      </button>`).join('');
  }

  function updateSelection(id,focusEl=true){
    const cards=[...siteGrid.querySelectorAll('.site-card')];
    const root=siteGrid;
    cards.forEach(c=>{
      const on=c.dataset.id===id;
      c.setAttribute('aria-checked',on?'true':'false');
      c.tabIndex=on?0:-1;
      if(on&&focusEl)c.focus();
    });
    selectedId=id||null;
    continueBtn.disabled=!selectedId;
    if(selectedId){root.classList.add('has-selection');}
    else{root.classList.remove('has-selection');}
  }

  /* ===== Load persisted selection (with legacy import) ===== */
  async function loadSelection(){
    // One-time legacy import if the old key exists
    const legacy = localStorage.getItem('siteSelection');
    if(legacy){
      // Validate legacy value
      const legacyId = String(legacy);
      if(SITES.some(s=>s.id===legacyId)){
        await Persist.save(lastEmp, PAGE_ID, { selectedSiteId: legacyId, selectedSiteName: SITES.find(s=>s.id===legacyId).name, ts: Date.now() });
      }
      localStorage.removeItem('siteSelection');
    }

    const rec = await Persist.load(lastEmp, PAGE_ID);
    if(rec && rec.selectedSiteId && SITES.some(s=>s.id===rec.selectedSiteId)){
      updateSelection(rec.selectedSiteId, false);
    }
  }

  /* ===== Save selection ===== */
  async function persistSelection(){
    if(!selectedId) return;
    const s = SITES.find(x=>x.id===selectedId);
    await Persist.save(lastEmp, PAGE_ID, {
      selectedSiteId: selectedId,
      selectedSiteName: s ? s.name : selectedId,
      ts: Date.now()
    });
  }

  /* ===== Events ===== */
  function onCardClick(e){
    const card=e.target.closest('.site-card');
    if(!card)return;
    updateSelection(card.dataset.id);
  }

  async function onContinue(){
    if(!selectedId) return;
    await persistSelection();
    window.location.href = pageForSite(selectedId);
  }

  async function onClear(){
    selectedId=null;
    continueBtn.disabled=true;
    siteGrid.classList.remove('has-selection');
    [...siteGrid.querySelectorAll('.site-card')].forEach((c,i)=>{
      c.setAttribute('aria-checked','false');
      c.tabIndex=i===0?0:-1;
    });
    siteGrid.querySelector('.site-card')?.focus();
    // Clear only this page's state (keep employee/session)
    await Persist.save(lastEmp, PAGE_ID, { selectedSiteId: '', selectedSiteName: '', ts: Date.now() });
  }

  /* ===== Init ===== */
  (async function init(){
    renderGrid();
    await loadSelection();
    siteGrid.addEventListener('click', onCardClick);
    continueBtn.addEventListener('click', onContinue);
    clearBtn.addEventListener('click', onClear);
  })();

})();
</script>

</body>
</html>
