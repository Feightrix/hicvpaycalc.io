<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Choose Your Calculator</title>
<style>
  :root{
    --green:#1B5E20; --green-600:#124318; --orange:#FF7A00;
    --paper:#FFFFFF; --ink:#1f2937; --muted:#6b7280;
    --border:#e5e7eb; --shadow:0 8px 28px rgba(0,0,0,.08), 0 2px 8px rgba(0,0,0,.05);
    --bar-bg: rgba(255,255,255,.22);
    --splash-duration: 2500ms;
    --reveal-duration: 260ms;
    --card-reveal: 380ms;
  }
  *{box-sizing:border-box}
  html,body{
    margin:0; width:100%; min-width:100%;
    color:var(--ink); font-family:ui-sans-serif,system-ui;
    background:#f8fafc; min-height:100vh;
  }
  body.no-scroll{overflow:hidden;}
  body:not(.app-ready) .app-shell{visibility:hidden;}

  /* ================= SPLASH ================= */
  .splash{
    position:fixed; inset:0; z-index:9999;
    background:var(--green);
    display:flex; flex-direction:column;
    align-items:center; justify-content:center;
    text-align:center;
  }
  .splash-inner{
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    gap:24px; max-width:700px; transform: translateY(-5vh);
  }
  .splash-logo{
    width:min(32vw,340px); height:auto; object-fit:contain;
    opacity:0; transform:translateY(6px);
    animation:logoIn .6s ease-out .15s forwards;
    background:transparent; border:none; box-shadow:none;
  }
  @keyframes logoIn{to{opacity:1;transform:translateY(0);}}
  @media(max-width:600px){.splash-logo{width:60vw; max-width:60vw;}}
  .bar-wrap{
    width:min(420px,84vw); height:12px; border-radius:999px; background:var(--bar-bg);
    overflow:hidden; border:1px solid rgba(255,255,255,.28); box-shadow:inset 0 2px 6px rgba(255,255,255,.08);
  }
  .bar{
    height:100%; width:0%; border-radius:999px;
    background:linear-gradient(90deg,#78C27F 0%,#A5D6A7 50%,#78C27F 100%); background-size:200% 100%;
    animation: fill var(--splash-duration) ease-out forwards, shimmer 1.8s linear infinite, glowPulse 2.4s ease-in-out infinite;
  }
  @keyframes fill{0%{width:0%}18%{width:18%}42%{width:40%}68%{width:70%}86%{width:86%}100%{width:100%}}
  @keyframes shimmer{0%{background-position:200% 0;}100%{background-position:-200% 0;}}
  @keyframes glowPulse{0%,100%{box-shadow:0 0 10px rgba(255,255,255,0.18),0 0 22px rgba(255,255,255,0.10);}50%{box-shadow:0 0 22px rgba(255,255,255,0.35),0 0 40px rgba(255,255,255,0.18);}}
  .splash::after{
    content:""; position:absolute; inset:0; pointer-events:none; opacity:0;
    background:linear-gradient(105deg,rgba(255,255,255,0)0%,rgba(255,255,255,.55)50%,rgba(255,255,255,0)100%);
    transform:translateX(-120%)skewX(-8deg);
  }
  .splash.out::after{animation:sheenSweep .45s ease-out forwards;}
  @keyframes sheenSweep{0%{opacity:0;transform:translateX(-120%)skewX(-8deg);}12%{opacity:.9;}100%{opacity:0;transform:translateX(120%)skewX(-8deg);}}
  .splash.out{animation:splashFade .42s ease .25s forwards;}
  @keyframes splashFade{to{opacity:0;}}
  .splash-footer{position:fixed;left:0;right:0;bottom:10px;text-align:center;color:rgba(255,255,255,.8);font-size:12px;}

  /* ================= PAGE ================= */
  .app-header.app-shell{
    position:sticky;top:0;z-index:20;
    background:linear-gradient(180deg,rgba(255,255,255,.95),rgba(255,255,255,.85));
    border-bottom:1px solid var(--border);
    opacity:0;transform:translateY(8px);
    transition:opacity var(--reveal-duration)ease,transform var(--reveal-duration)ease;
  }
  main.container.app-shell{
    opacity:0;transform:translateY(8px);
    transition:opacity var(--reveal-duration)ease,transform var(--reveal-duration)ease;
    padding-top:24px;
  }
  body.app-ready .app-header.app-shell,
  body.app-ready main.container.app-shell{opacity:1;transform:none;visibility:visible;}
  .container{max-width:1100px;width:100%;margin:0 auto;padding:0 16px;}
  .header-row{display:flex;align-items:center;gap:12px;height:clamp(52px,7vw,96px);}
  .logo-img{height:calc(100% - 10px);width:auto;object-fit:contain; content:url('images/HI-Emblem-green.png');}

  .card{
    background:var(--paper);border:1px solid var(--border);border-radius:14px;
    box-shadow:var(--shadow);width:min(520px,92vw);
    opacity:0;transform:translateY(14px)scale(0.97); will-change:transform,opacity;
    animation:cardIn var(--card-reveal)cubic-bezier(0.25,0.8,0.25,1) .15s forwards;
  }
  @keyframes cardIn{from{opacity:0;transform:translateY(14px)scale(0.97);}to{opacity:1;transform:none;}}
  .card-header{padding:16px 20px 10px;border-bottom:1px solid var(--border);
    background:linear-gradient(180deg,color-mix(in srgb,var(--green)7%,#fff),#fff 80%);
    border-left:4px solid var(--orange);border-top-left-radius:14px;}
  .card-header h2{margin:0;font-size:18px;color:var(--green-600);}
  .card-body{padding:18px 20px;}
  .field{display:grid;gap:8px;margin-bottom:14px;}
  .label{font-weight:800;color:var(--green-600);font-size:16px;}
  .input{display:flex;align-items:center;background:#fff;border:1px solid var(--border);
    border-radius:12px;padding:10px 12px;box-shadow:0 6px 20px rgba(0,0,0,.04);}
  select,input[type="text"],input[type="number"]{width:100%;border:0;outline:0;font-size:16px;background:transparent;color:var(--ink);}
  .desc{margin-top:6px;padding:12px 14px;background:#fff;border:1px solid var(--border);
    border-radius:12px;color:var(--muted);line-height:1.45;}
  .btn{display:inline-flex;align-items:center;justify-content:center;border-radius:999px;
    padding:10px 18px;margin-top:16px;font-weight:700;border:1px solid var(--border);
    background:#fff;color:var(--green);cursor:pointer;transition:all .15s ease;}
  .btn:hover{border-color:#d1d5db;box-shadow:0 6px 16px rgba(0,0,0,.08);transform:translateY(-1px);}
  footer{position:fixed;bottom:10px;left:0;right:0;text-align:center;font-size:13px;color:#97a0aa;}

  /* Sign-in area */
  .signin{display:grid;gap:10px;margin:4px 0 12px;}
  .signin-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
  @media(max-width:620px){.signin-row{grid-template-columns:1fr;}}
  .remember{display:flex;align-items:center;gap:8px;color:#6b7280;font-size:14px;}
  .remember input{width:auto;}
  .welcome{margin:-2px 0 10px; color:var(--green-600); font-weight:800; display:none;}

  /* Modal */
  .modal-backdrop{position:fixed;inset:0;display:none;background:rgba(15,23,42,.45);
    align-items:center;justify-content:center;padding:16px;z-index:60;}
  .modal{width:min(420px,92vw);background:#fff;border-radius:16px;border:1px solid var(--border);
    box-shadow:0 24px 64px rgba(0,0,0,.25);padding:20px;}
  .modal h4{margin:0 0 .25rem;font-size:20px;color:var(--green-600);}
  .modal p{margin:0 0 1rem;color:var(--muted);font-size:14px;}
  .row{display:flex;gap:10px;align-items:center;}
  .input-inline{flex:1;display:flex;align-items:center;gap:.5rem;border:1px solid var(--border);
    border-radius:10px;padding:.7rem .8rem;background:#fff;}
  .input-inline input{border:0;outline:0;width:100%;font-size:15px;}
  .btn.secondary{background:#eef2f7;color:#111;border:1px solid var(--border);}
  .err{margin-top:.6rem;color:#b71c1c;font-size:13px;display:none;}
</style>
</head>
<body>

<!-- SPLASH -->
<div class="splash" id="splash">
  <div class="splash-inner">
    <img class="splash-logo" src="images/HI-Emblem-White.png" alt="Holiday Inn Club Vacations Emblem (White)">
    <div class="bar-wrap"><div class="bar" id="progressBar"></div></div>
  </div>
  <div class="splash-footer">Built by Feight © Copyright 2025</div>
</div>

<!-- HEADER -->
<header class="app-header app-shell" id="appHeader">
  <div class="container header-row">
    <img alt="Holiday Inn Club Vacations Emblem" class="logo-img">
  </div>
</header>

<!-- CONTENT -->
<main class="container app-shell" id="mainContent">
  <section class="card">
    <div class="card-header"><h2>Choose Your Calculator</h2></div>
    <div class="card-body">

      <!-- Welcome line (appears after sign-in or restore) -->
      <div id="welcomeLine" class="welcome" aria-live="polite"></div>

      <!-- Sign-in strip -->
      <div class="signin" id="signinSection">
        <div class="signin-row">
          <div class="input">
            <input id="empNumber" type="text" inputmode="numeric" placeholder="Employee Number (e.g., 078195)" aria-label="Employee number" autocomplete="on">
          </div>
          <div class="input">
            <input id="empName" type="text" placeholder="First name (required)" aria-label="First name" autocomplete="given-name">
          </div>
        </div>
        <label class="remember"><input id="rememberMe" type="checkbox"> Remember me on this device</label>
        <button id="signInBtn" class="btn" type="button">Sign In</button>
        <div id="signinStatus" class="desc" style="display:none;"></div>
      </div>

      <!-- Calculator selection -->
      <div class="field">
        <div class="label">Select a tool</div>
        <div class="input">
          <select id="calcSelect" aria-label="Choose calculator">
            <option value="pay">Pay Calculator</option>
            <option value="site">Site Calculator</option>
          </select>
        </div>
      </div>
      <div id="calcDescription" class="desc">
        View your potential weekly pay breakdown and see how Master’s Trip points are calculated.
      </div>
      <button id="submitBtn" class="btn" type="button">Submit</button>

    </div>
  </section>
</main>

<footer class="app-shell" id="pageFooter">Built by Feight © Copyright 2025</footer>

<!-- Password Modal -->
<div class="modal-backdrop" id="pwBackdrop">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="pwTitle" aria-describedby="pwDesc">
    <h4 id="pwTitle">Enter Password</h4>
    <p id="pwDesc">The Site Calculator requires a password to continue.</p>
    <div class="row" style="margin-bottom:.75rem">
      <div class="input-inline">
        <input id="pwInput" type="password" placeholder="Password" autocomplete="current-password" />
        <button class="btn secondary" id="togglePw" type="button" aria-label="Show or hide password">Show</button>
      </div>
      <button class="btn" id="pwSubmit" type="button">Continue</button>
    </div>
    <div class="err" id="pwErr">Incorrect password. Try again.</div>
    <div class="row" style="justify-content:flex-end; margin-top:.5rem">
      <button class="btn secondary" id="pwCancel" type="button">Cancel</button>
    </div>
  </div>
</div>

<script>
/* =========================
   Persist API (swap-ready)
   ========================= */
const Persist = (() => {
  const USE_SUPABASE = false;
  const SUPABASE_URL = 'https://YOUR_PROJECT_ID.supabase.co';
  const SUPABASE_ANON = 'YOUR_ANON_KEY';
  const TABLE = 'calculator_state';
  const LOCAL_PREFIX = 'hi-calc:v1';
  const key = (emp,page)=> `${LOCAL_PREFIX}:${emp}:${page}`;

  async function load(emp,page){
    if(!emp) return null;
    const raw = localStorage.getItem(key(emp,page));
    return raw ? JSON.parse(raw) : null;
  }
  async function save(emp,page,data){
    if(!emp) return;
    localStorage.setItem(key(emp,page), JSON.stringify(data));
    return true;
  }
  function getLastEmployee(){ return localStorage.getItem(`${LOCAL_PREFIX}:last-employee`) || ''; }
  function setLastEmployee(emp){ if(emp) localStorage.setItem(`${LOCAL_PREFIX}:last-employee`, emp); }
  function clearLastEmployee(){ localStorage.removeItem(`${LOCAL_PREFIX}:last-employee`); }
  return {load, save, getLastEmployee, setLastEmployee, clearLastEmployee};
})();

/* ============
   Page Script
   ============ */
(() => {
  document.body.classList.add('no-scroll');

  const splash = document.getElementById('splash');
  const progress = document.getElementById('progressBar');

  /* Modal */
  const REQUIRED_PASSWORD="bookem";
  const LINKS={ pay:"./site-selection.html", site:"./site-calculator.html" };
  const DESCRIPTIONS={
    pay:"View your potential weekly pay breakdown and see how Master’s Trip points are calculated.",
    site:"Track pacing against budget and team goals with clear running totals and on-the-fly projections."
  };
  const backdrop=document.getElementById('pwBackdrop');
  const pwInput=document.getElementById('pwInput');
  const pwSubmit=document.getElementById('pwSubmit');
  const pwCancel=document.getElementById('pwCancel');
  const pwErr=document.getElementById('pwErr');
  const togglePw=document.getElementById('togglePw');

  function forceReadyState(){
    // kill any blocking overlays after back/forward restore
    document.body.classList.add('app-ready');
    document.body.classList.remove('no-scroll');

    if(splash){
      splash.classList.remove('out');
      splash.style.display = 'none';
    }
    if(backdrop){
      backdrop.style.display = 'none';
      backdrop.setAttribute('aria-hidden','true');
    }
  }

  function finishSplash(){
    document.body.classList.add('app-ready');
    document.body.classList.remove('no-scroll');
    splash.style.display = 'none';
  }

  function startExit(){
    // prevent double-trigger
    if(!splash || splash.style.display === 'none') return;

    splash.classList.add('out');
    splash.addEventListener('animationend', function onEnd(e){
      if(e.animationName==='splashFade'){
        splash.removeEventListener('animationend', onEnd);
        finishSplash();
        restoreIfRemembered();
      }
    });
  }

  const reduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion:reduce)').matches;

  if(reduced){
    finishSplash();
    restoreIfRemembered();
  } else {
    // Only trigger exit on the FINITE "fill" animation, and only once
    progress.addEventListener('animationend', (e)=>{
      if(e.animationName === 'fill') startExit();
    }, { once:true });
  }

  // IMPORTANT: when returning via browser back (bfcache), force-unblock the page
  window.addEventListener('pageshow', () => {
    forceReadyState();
    restoreIfRemembered();
  });

  /* DOM refs */
  const empNumber = document.getElementById('empNumber');
  const empName   = document.getElementById('empName');
  const remember  = document.getElementById('rememberMe');
  const signInBtn = document.getElementById('signInBtn');
  const signinStatus = document.getElementById('signinStatus');
  const welcomeLine  = document.getElementById('welcomeLine');

  const selectEl = document.getElementById('calcSelect');
  const descEl   = document.getElementById('calcDescription');
  const submitBtn= document.getElementById('submitBtn');

  function setStatus(msg, show=true){
    signinStatus.textContent = msg || '';
    signinStatus.style.display = show && msg ? 'block' : 'none';
  }
  function showWelcome(name){
    if(name){
      welcomeLine.textContent = `Welcome, ${name}!`;
      welcomeLine.style.display = 'block';
    } else {
      welcomeLine.textContent = '';
      welcomeLine.style.display = 'none';
    }
  }

  function normalizeEmp(n){ return (n||'').replace(/\s+/g,'').padStart(6,'0'); }
  function toFirstName(s){
    const t = (s||'').trim();
    if(!t) return '';
    return t.split(/\s+/)[0];
  }

  async function restoreIfRemembered(){
    const lastEmp = Persist.getLastEmployee();
    if(!lastEmp) return;
    empNumber.value = lastEmp;
    remember.checked = true;
    await restoreState();
  }

  async function restoreState(){
    const emp = normalizeEmp(empNumber.value);
    if(!emp){
      setStatus('Enter your employee number and first name to load saved progress.');
      showWelcome('');
      return;
    }
    setStatus('Loading your saved settings…');
    const saved = await Persist.load(emp, 'calculator-selection');
    if(saved && typeof saved === 'object'){
      const first = toFirstName(saved.name);
      empName.value = first;
      if(saved.selection) selectEl.value = saved.selection;
      updateDescription();
      setStatus(`Welcome back, ${first}! Your last selection has been restored.`);
      showWelcome(first);
    } else {
      setStatus('No previous data found. Make a selection to get started.');
      showWelcome('');
    }
  }

  async function signIn(){
    const emp = normalizeEmp(empNumber.value);
    const first = toFirstName(empName.value);
    if(!emp){ setStatus('Please enter a valid employee number.', true); empNumber.focus(); return; }
    if(!first){ setStatus('First name is required.', true); empName.focus(); return; }

    if(remember.checked) Persist.setLastEmployee(emp);
    else Persist.clearLastEmployee();

    await Persist.save(emp, 'calculator-selection', { name:first, selection: selectEl.value, ts: Date.now() });
    setStatus(`Signed in as ${first}.`);
    showWelcome(first);
  }

  async function saveSelection(){
    const emp = normalizeEmp(empNumber.value);
    const first = toFirstName(empName.value);
    if(!emp || !first) return;
    await Persist.save(emp, 'calculator-selection', { name:first, selection: selectEl.value, ts: Date.now() });
  }

  function updateDescription(){ descEl.textContent = DESCRIPTIONS[selectEl.value] || ""; }

  function openModal(){
    backdrop.style.display='flex';
    backdrop.setAttribute('aria-hidden','false');
    document.body.classList.add('no-scroll');
    pwErr.style.display='none';
    pwInput.value='';
    setTimeout(()=>pwInput.focus(),30);
  }
  function closeModal(){
    backdrop.style.display='none';
    backdrop.setAttribute('aria-hidden','true');
    document.body.classList.remove('no-scroll');
  }
  function trySubmitPassword(){
    const val = (pwInput.value || '').trim();
    if(val === REQUIRED_PASSWORD){
      // ensure modal cannot "stick" in history
      closeModal();
      window.location.href = LINKS.site;
    } else {
      pwErr.style.display='block';
      pwInput.focus();
      pwInput.select();
    }
  }

  async function handleSubmit(){
    try{
      const emp = normalizeEmp(empNumber.value);
      const first = toFirstName(empName.value);

      if(!emp){ setStatus('Enter your employee number before continuing.', true); empNumber.focus(); return; }
      if(!first){ setStatus('First name is required.', true); empName.focus(); return; }

      await saveSelection();
      showWelcome(first);

      if(selectEl.value==='pay'){
        window.location.href = LINKS.pay;
      } else {
        openModal();
      }
    } catch (err){
      console.error('Submit failed:', err);
      setStatus('Something blocked navigation. Open console for details.', true);
    }
  }

  /* Wire up */
  selectEl.addEventListener('change', () => { updateDescription(); saveSelection(); });
  signInBtn.addEventListener('click', signIn);
  empNumber.addEventListener('keydown', e=>{ if(e.key==='Enter') signIn(); });
  empName.addEventListener('keydown',  e=>{ if(e.key==='Enter') signIn(); });

  submitBtn.addEventListener('click', handleSubmit);

  pwCancel.addEventListener('click', closeModal);
  pwSubmit.addEventListener('click', trySubmitPassword);
  pwInput.addEventListener('keydown', e => { if(e.key==='Enter') trySubmitPassword(); });

  togglePw.addEventListener('click', ()=>{
    const showing = pwInput.type === 'text';
    pwInput.type = showing ? 'password' : 'text';
    togglePw.textContent = showing ? 'Show' : 'Hide';
    pwInput.focus();
  });

  updateDescription();
})();
</script>

</body>
</html>
